---
sidebar_position: 5
description: 控制反复发生的条件与次数，以构建更复杂的结构
---
import C from '@site/src/mdx'

# 条件反复、多次反复 {#advanced-repeat}

本节我们介绍反复记号的高级用法——条件反复与多次反复。它们在之前的章节中已经有出现过，因此，我们就简单地重申一下它们的用法。

## 不带标注的反复记号 {#unlabeled-repeats}

一般不带标注的后反复记号只能使用一次，然后就会「损坏」，不再发挥作用；前反复记号则可以多次发挥作用。

<C.RealtimeScore efRange={1} children={
`P: 1=C 5/4
// highlight-next-line
N: 2 4 (32)(35) 1 ||: 7d 2 (21)(21) 7d | 1 3 (32)(32) 1 :|| 5 2 (21) (17d) 1 :||
`
} />

此例子的奏唱顺序：第一遍 1-3 小节，第二遍 2-4 小节，第三遍 2-4 小节，然后结束。

在有标号的跳房子记号中，后反复记号永远都会发挥作用，不会「损坏」。

<C.RealtimeScore efRange={1} children={
`P: 1=C 6/8
---
N: (321)2 (5) |
---
// highlight-next-line
J: 1., 2.
N: 2 (2)(234) :||
---
// highlight-next-line
J: 3.
N: 4 (4)(432) :||
---
N: 1 (1) 1 (0) |||`
} />

此例子的奏唱顺序：第一遍 1-2 小节，第二遍 1-2 小节，第三遍 \(1, 3) 小节，第四遍 \(1, 4) 小节。

可见，第二小节末尾的后反复记号使用了两次。

特别一提，当遇到后反复记号时，会先将反复迭代数增加 1，然后再寻找对应的前反复记号。

<C.RealtimeScore efRange={1} children={
`P: 1=C 4/4S
N: (6#5)6 (6=5)(34) |
---
// highlight-next-line
J: 1., 2.
// highlight-next-line
N: 5 (12)3 (23) ||: 4 5 6 7 :||
---
N: 5 2 (3#4) 5 |
`
} />

此例子的奏唱顺序：第一遍 1-3 小节，第二遍 (3) 小节，第三遍 (1, 4) 小节。

## 条件反复 {#conditional-repeat}

条件反复就是通过在反复记号上加注迭代数，限制其作用范围。只有当此时迭代数与反复记号上加注的迭代数一致时，反复记号才会起作用。反复条件标注既可以用于后反复记号，也可以用于前反复记号。

在 Sparks NMN 中，条件反复的迭代数通过小节线属性的形式标注。其中，前置属性用于后反复记号，后置属性用于前反复记号。

<C.RealtimeScore efRange={1} children={
`P: 1=C 6/8
---
N: 1. (7d17d) ||:{3.} 6d. (#5d6d7d) | 2. (127d) {1.,2.}:|| 6d (6d) 6d. |||
`
} />

此例子的奏唱顺序：第一遍 1-3 小节，第二遍 1-3 小节，第三遍 2-4 小节。

可见，后反复记号标记了迭代数后，将不再具有作用次数的限制，可以多次作用。

## 多次反复 {#multitime-repeat}

多次反复指定了后反复记号在「损坏」前的作用次数。反复次数通过 `x<次数>` 的形式标注于前置属性上。

<C.RealtimeScore efRange={1} children={
`P: 1=C 2/4
---
N: ((1232))((1232)) ||: ((1232))((1217d)) | ((1232))((1242)) {x4}:|| ((17d17d))(6d0) |||
`
} />

此例子中，2-3 小节总共将奏唱 5 次。相当于，

<C.RealtimeScore efRange={1} children={
`P: 1=C 2/4
---
N: ((1232))((1232)) ||: ((1232))((1217d)) | ((1232))((1242)) {1., 2., 3., 4.}:|| ((17d17d))(6d0) |||
`
} />

前面已经提到过，以下情况不需要标注多次反复：

- 后反复记号位于标有迭代数的跳房子记号中。
- 后反复记号已经标注了迭代数。

## 挑战 {#challenges}

<C.Challenges>
<C.Challenge title='完整歌曲听写与记谱'>

作为本章的总挑战题，我们进行一个整首歌的旋律听写。

听歌曲[《秘境茶会》](https://y.qq.com/n/ryqq/songDetail/003d9zJy03q4Gh)，使用简谱对其进行完整记录。你记录的乐谱应当包含完整的歌词和相对准确的节奏描述，在必要的时候可以包含多声部。此外，还应当尽量使用反复与区分的记号，避免重复记录相同的部分。完成后，请添加标题、作者等信息，使其成为完整的乐谱。

这首歌的曲式结构较为复杂，如果一下子搞不清楚，可以参考[反复迭代数](/docs/tutorial-structure/understanding-iter)一节中的分析方法进行分析。

<C.HintSolution>
<C.Hint>

曲式结构的缩略图如下：

<C.RealtimeScore efRange={[1,13]} hide children={
`P: 1=? 4/4
Rp: n=6 sectionorder=none font_annotation2=CommonLight/400/0.9
====
N: 0___ |
A: "前奏A"
---
N: 1___ |
A: "主歌A(1)"
A: "不同类型的主歌A末尾不同"
L:
A: "蔷薇的庄园..."
---
N: 0___ |
A: "前奏B"
---
N: 1___ |
A: "主歌A(2)"
L:
A: "翻开下一页..."
---
N: 2___ |
A: "主歌B"
L:
A: "跟随着..."
---
N: 3___ |
A: "副歌(I)"
L:
A: "音律回旋..."
---
N: 4___ ||
A: "延续段(I)"
L:
A: "慢点慢点..."
---
N: 1___ |
A: "主歌A(2)"
L:
A: "沉默的茶点..."
---
N: 2___ |
A: "主歌B'"
L:
A: "端坐在..."
---
N: 3___ |
A: "副歌(I')"
L:
A: "随风笛雀跃..."
---
N: 0___ |
A: "间奏.小调"
---
N: 0___ |
A: "间奏.大调"
---
N: 4___ ||
A: "延续段(II)"
L:
A: "快点快点..."
---
N: 1___ |
A: "主歌A(1)"
L:
A: "八音盒中间..."
---
N: 0___ |
A: "前奏B"
---
N: 1___ |
A: "主歌A(3)"
L:
A: "纸牌的背面..."
---
N: 3___ |
A: "副歌(I)"
L:
A: "音律回旋..."
---
N: 3___ |||
A: "副歌(II')"
L:
A: "随风笛雀跃..."
`
} />

</C.Hint>
<C.Solution>

在曲式结构分析上，答案是不唯一的。只要能正确且合理地表示这首歌的信息，都是正确的。

一个可能的版本如下：

<C.RealtimeScore children={
`Dp: 补全计划 - Netheric Playlist #0424
Dt: 秘境茶会
Da[原唱]: 依溪禾/熊子
Da[作词]: 成方言
Da[作曲]: 依溪禾
P: 1=C 6/8
Rp: page=A4
Rp: note_count_lining=true
====
Srp: font_lyrics=Roman,CommonSerif/600/0.95
---
N: /{6/4, qpm=115} &lpr; 6d (3#2) 3 4 3 2 | 2 7d - - 0 0 | 1 (17d) 1 3 (#5d6d) 7d | (6dd7dd) (1d3d) (6d7d) (1.(3)) /||
---
N: /{6/8, spm=233} (6d(3#2)3)(432)|2. 0 (0)|(1(17d)1)(7d(7d6d)7d)| #5d. 0 (0) |
---
N: (6d(3#2)3)(432)|2. 0 (0)|(1(17d)1)(7d(7d6d)7d)|{3/4} #5d 6d 7d |
---
N: /{6/8} 3. (434) | 3. (431)  &rpr; |
---
N: ||:{3.} 3. 3 (1) | #2. 7d. | 2. (217d) | 7d. (7d12) |
Lc[1.]: 蔷薇的庄园，月光在屋檐，滴答答
Lc[3.]: 八音盒中间，发条上了弦，叮咚咚
---
N: 3. 3 (1) | #2. 7d (=2) | 4. (43#2) | 3 - - |
Lc[1.]: 钟摆沿着线，敲响了十二点。
Lc[3.]: 敲开了假面，玫瑰开始凋谢。
---
Frp: n=5
N: &lpr; (6(67)(1e2e))(b3e2e#1e) | (6(67)(1e2e))(3e3e#5) | (3(34)3)(#2(23)2) | (27d2) 3.&rpr; |{1/8, w=0.3} (0) |
---
N: ||:{6/8, 2.} 3. 3 (1) | #2. 7d. | 2. (217d) | 7d. (7d12) |
Lc[1.]: 翻开下一页，请稍候床边。打碎了
Lc[2.]: 沉默的茶点，乖巧地镶嵌。剥落了
Lc[3.]: 纸牌的背面，猫露出笑脸。推倒了
---
N: 3. 3 (1) | #2. #4(7) |
Lc[1.]: 橘子酱 发现橱
Lc[2.]: 烫金字 露出褪
Lc[3.]: 多米诺 尽头是
---
J: 1., 2., *
N: 6. (6#56) | 7. (3#57) | 6 (6)(6#56) | 7(7)(71e2e) | (3e2e1e)(2e1e7) | 7. (71e2e) |
Lc[1.]: 窗里的世界。跟随着萤火虫的曲线，那兔子的礼服里掉落请柬。鸢尾装
Lc[2.]: 色的星期天。      端坐在圆桌中间，被嚣张的荆棘勾住裙边。灯火彻
Ns: 2: 7. 0. |
---
J:
N: 1e (1e)(1e2e3e) | 2e (2e)(2e3e4e) | 3e~ - - | 3e. 0. |
Lc[1.]: 点，灌木林背面，排列了盛宴。
Lc[2.]: 夜，女王的杖尖，点燃了盛典。
---
J: 3.
N: 6. (6#57) | 3e - - |
Lc[3.]: 午夜的终点。
---
N: (63e3e) 4e(3e) | #2e(7) 3e(3e) | (671e)(71e2e) | 3e. #5(0) |
Lc[1., 3.]: 音律回旋，踮起脚尖，跟红舞鞋画一个半圆。
Lc[2.]: 随风笛雀跃，舞步回旋，庆祝时间在鼓点兜圈。
Ns: 1: (6(3e#2e)3e) 4e(3e) |
---
N: (63e3e) 4e(3e) | #2e(4e) 3e(3e)  | (671e)(71e2e) | 3e.~ 3e. |
Lc[1., 3.]: 飞旋裙边，簇拥黑夜，听交响诗即兴开演。
Lc[2.]: 在红舞鞋支配的终结，不眠的夜倾情上演。
Ns: 1: (6(3e#2e)3e) 4e(3e) |
---
J: 1.
Frp: n=6
N: /{spm=215,3/8} 1e(1e) | 7(7) | 6(6) | #5(5) | 6(6) | #5(5) |
Lc: 慢点慢点，听说陛下藏在我们
N["白"]: /{3/8} 0. | 0. | 0. | 0. | 0. | 0 ((0X~)) |
Lc: 欸，
---
J:
Frp: n=5
N: /{w=0.7} 6(1e) |{w=0.7} 7~. |{4/8, w=0.8} 7.(0) {spm=233, 6/8}:||
Lc: 的中间。
N["白"]: (X(0X))(X) | (0(XX~))((X0)) |{4/8} 0. (0) {6/8}:||
Lc: 在哪，在哪？
---
J: 2., *
N: /[6/8] 3e(1e) 6. | #2e(7) #5. | 2e(7) 2e. | 1e.~ (1e71e) |
N["白"]: /[6/8] 0. 0. | 0. 0. |
---
J:
Frp: n=5
N: 3e(1e) 6. | #2e(7) #5. | 2e(7) 4e(3e) |{3/8, w=0.8} (71e2e) |{3/4} 3 #5 7 |
---
J:
Frp: n=5
N: /{6/8} 3e. (#1e2e3e) | 4e. (4e3e2e) | 2e. (71e2e) | 3e. (3e2e1e) | 1e. (671e) | 2e. (2e1e7) | 7. (71e7) | 1e. 2e. |
---
J:
Frp: n=5
N: 3e. (=1e2e3e) | 4e. (4e3e2e) | 2e. (71e2e) | 3e. (3e2e1e) | 1e. (671e) | 2e. (2e1e7) | 7. (71e7) | 1e. 5e. | 3e~. 3e. |
---
J:
Frp: n=6
N: /{"  ", spm=215,3/8} 1e(1e) | 7(7) | 6(6) | #5(5) | 6(6) | #5(5) |
Lc: 快点快点，陛下发现我们前抓
---
J:
Frp: n=5
N: /{w=0.6, 2/8} 6 |{w=0.7, 3/8} 1e. |{3/4} 7 - - {spm=233, 6/8}:||
Lc: 紧时间。
N["白"]: /{2/8} 0 |{3/8} 0. |{3/4} 0 (XX) (XX) {6/8}:||
Lc: 快点快点！
---
J: 3., *
N: /[6/8]{" ", 1=D, *} (6(3e#2e)3e) 4e(3e) | #2e(7) 3e(3e) | (671e)(71e2e) | 3e. #5(0) |
Lc: 随风笛雀跃，舞步回旋，直觉在梦境之间沦陷。
N["白"]: /[6/8] 0. 0. | 0. 0. |
---
J:
N: (6(3e#2e)3e) 4e(3e) | #2e(4e) 3e(3e)  | (671e)(71e2e) | 3e.~ 3e. |||
Lc: 时空交叠，狂欢来纪念，不眠的夜尽情跳跃。
`
} />

</C.Solution>
</C.HintSolution>

</C.Challenge>
</C.Challenges>

## 接下来... {#next}

下一章，标记符号，将介绍添加力度、和弦和自定义文本标记的方法。此外，我们还要介绍如何通过标记的方式在没有音符的位置添加歌词，这就是前文提到但没有介绍的标记型歌词。
