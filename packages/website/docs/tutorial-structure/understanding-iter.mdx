---
sidebar_position: 2
description: 了解记谱规范中对反复次数编号的规则
---
import C from '@site/src/mdx'
import * as Icons from 'react-icons/vsc'

# 反复迭代数* {#understanding-iter}

乐谱中许多地方会用到「第几遍」的标号，例如在多行歌词和跳房子记号中。当一份乐谱中出现多组多行歌词或跳房子记号时，不同人标号的方法可能会不一样，并且目前最常见的方法并不足以被推广以应对复杂的曲式结构。因此，本节我们将介绍 Sparks NMN 推荐采用的标号方式——**反复迭代数**。这是一种规则简单、易于理解、容易推广且不会产生歧义与混淆的方式。

:::note 备注

本节内容以理解为主，读者不必过度关注各种记号对应的 Sparks NMN 语法——后面会提到的。

:::

## 乐谱中的数字 {#numbering}

乐谱中的反复，就是将相同的部分放到一起书写。然而，许多相同的地方并非完全相同，总有一些区别，体现在乐谱上，就是要在同一个地方区分不同的反复次数。标号是最常用的区分方法。下面，我们看两个用到标号的典型场景，分别是多行歌词和跳房子记号。

### 多行歌词 {#lrc-numbering}

多行歌词为不同的反复次数指定了不同的歌词，表示「第几次」的标号写在歌词行前。下面的例子来自歌曲[《小手拉大手》](https://www.kuwo.cn/play_detail/213974)。

<C.RealtimeScore efRange={[29,33]} children={
`Dp: 补全计划 - Netheric Playlist #0274
Dt: 小手拉大手
Da[原唱]: 梁静茹
Da[作词]: 陈绮贞
Da[作曲]: 过亚弥乃
P: 1=C 4/4
====
Srp: font_lyrics=Roman,CommonSerif/600/0.95
---
N: &lpr; 1e[((4))] - - - | 1e[((3))] - - - | 1e[((4))] - 2e[((5))] - | 1 (11) (01)1 |
---
N: 1 &rpr; (05d)(5d6d)(12) ||: 3 (6) 5 (3)(22^) | 1^ (01)(21)(7d1) | 4 (6d) 1 3 (3^) |
Lc: %还记得那场音乐会的烟火，还记得那个凉凉的深秋。
---
N: 2^ (02)(32)(#12) | 5 (7d) 2 (3)(22^) | 1^ (01)(21)(7d1) | 4 (6d) 1 6d (6d^) |
Lc: %还记得人潮把你推向了我，游乐园拥挤的正是时候。
---
N: 5d^ (05d)(5d6d)(12) | 3 (6) 5 (3)(22^) | 1^ (01)(21)(7d1) | 4 (6d) 1 3 (3^) |
Lc: %一个夜晚坚持不睡的等候，一起泡温泉奢侈的享受。
---
N: 2^ (02)(32)(#12) | 5 (7d) 2 (3)(22^) | 1^ (01)(21)(7d1) | 4 (6d) 1 2 (1~) |
Lc: %有一次日记里愚蠢的困惑，因为你的微笑幻化成风。
---
N: 1 (03)(43)(23) | 4 (3)2 3 (4~) | 4 (04)(54)(54) | 3 (2) 1 2 (3~) |
Lc: %你大大的勇敢保护着我，我小小的关怀喋喋不休。
---
N: 3 (03)(32)(#13) | 3 (2)2 (2)(#12~) | 2 (02)(23)(#42) | 6 (5) 5 #4 (5~) ||
Lc: 感谢我们一起走了那么久，又再一次回到凉凉深秋。
---
// preserve-start
N: 5 (03)(43)(45~) |[$] 5 (03)(43)(45~) | 5 (05)(65)(67) | 1e (3) 3 6 (6^) |
// highlight-next-line
Lc[1.]: 给你我的手，像温柔野兽，把自由交给草原的辽阔。
// highlight-next-line
Lc[2.,3.]: 给你我的手，像温柔野兽，我们一直就这样向前走。
---
N: 5^ - (01)(21) | 4 (3) 2 (1~) 1 | (3) 3 2 (1)(01) | 2 (6d) 1 3 (5~) |
Lc: %我们小手拉大手，一起郊游，今天别想太多。
// preserve-end
---
N: 5 (03)(43)(45~) | 5 (03)(43)(45~) | 5 (05)(65)(67) | 1e (3) 3 6 (6^) |
Lc[1.,2.]: 你是我的梦，像北方的风，吹着南方暖洋洋的哀愁。
Lc[3.]: 哦啦啦啦啦，像北方的风，吹着南方暖洋洋的哀愁。
---
N: 5^ - (01)(21) | 4 (3) 2 (1~) 1 | (3) 3 2 (1)(01) | 2 (6d) 1 2 (2^) |
Lc: %我们小手拉大手，今天加油，向昨天挥挥手。
---
J: 1.
N: 1^ - - - | 0 (05d)(5d6d)(12) :||
Lc: %还记得那场
---
J: 2., *
N: ^ 1^ - - - | &lpr; 7 6 5 4 | 5 - - 6 | 1 - 2 3 |
---
J:
N: 4 - (01e)(71e) | 7 6 5 4 | 6^ 5~ - - | 5^ - 6 - |
Lc: %啦啦啦啦啦啦啦啦_{1}
---
J: 2.
N: 1 - - - | 1 2 #4 - | 7d - 1 - | 2 &rpr; (03)(43)(45~) !{D.S.}||
Lc: %{7} 给你我的手，
---
J: 3., *
N: ^ 1^ - (01)(21) | (4) 3 2 (1)(11) | (4) 3 2 1 (1) | 2 (6d) 1 2 (2^) | 1^ - - - |
Lc: % 我们小手拉大手，今天为我加油，舍不得挥挥手。
---
J:
N: &lpr; 4 3 4 3 | (13d)(5d1)(05d)(15) | 4 3 (43)(45^~) | 5 - - 6d | 1^ - - - |
Lc: %{13}啦啦啦啦_{2}
---
J:
N: (13d)(5d1)(05d)(15) | 4 (03)(43)(45^) | 2e - - 6 | 1e^ - 6 7 |
Lc: %{8}啦啦啦啦啦_{3}
---
J:
N: 1e (1e) 1e b6 (1e^~) | 1e~ - (1eb6)(54^) | 5 (5) 5 3 (5~) | 5 - - - &rpr; |||
Lc: 啦啦啦啦啦_{0}[Wu_{2}]啦啦啦啦啦_{0}
`
} />

这个记法表示第一次经过第 31、32 小节时，歌词是「把自由交给草原的辽阔」，而第二次和第三次歌词均为「我们一直就这样向前走」。

### 跳房子记号 {#jumper-numbering}

再看一个跳房子记号的例子，来自歌曲[《宝贝宝贝》](https://www.kuwo.cn/play_detail/9847974)。

<C.RealtimeScore efRange={[41,49]} children={
`Dp: 补全计划 - Netheric Playlist #0428
Dt: 宝贝宝贝
Da[原唱]: 李昕融/樊桐舟/李凯稠
Da[作词]: 樊桐舟/朱鑫
Da[作曲]: 李凯稠
P: 1=C 4/4 qpm=128
====
N: e / e / &lpr; 3 (35~) 5 0 | 3 (51e) (2e3e) 5e |
---
N: 1e. (7) (1e5) (31e) | 7 - - - | 6. (5) (64) (16) | 5 - - - |
---
N: 3 - 5 1e | 2e. (2e) 6 - | 5 (56) (7) 1e (2e) | 1e - - - &rpr; |
---
N: ||: 1 2 3 1 | 2 5 5 0 | 3 (66) 6 6 | 5 5 3 0 |
Lc: 两只老虎爱跳舞，小兔子乖乖拔萝卜，
---
N: 1. (1) 1 (66) | 5 3 5 0 | (2) 2 (3) (32) (13) | 2 - 0 0 |
Lc: 我和小鸭子学走路，童年是最美的礼物。
---
N: 1 2 3 1 | 2 (55) 5 0 | 3 6 6 1e | 7 6 5 0 |
Lc: 小螺号呀嘀嘀地吹，我学海鸥展翅飞。
---
N: 1. (1) 1 6 | 5 5 3 0 | (2) 2 (3) (32) (12) | 1 - 0 (05) |
Lc: 不怕风雨不怕累，快快把本领都学会。宝
---
N: ||:{"  ", 3.} 1e (01e)(1e5)(31e) | 7 0 X (03) | 6 (06)(65)(67) | 5 0 X 0 |
Lc: 贝，星星为你指路。嗯？宝贝，月亮为你祝福。哦。
---
N: 3 (55) 5 1e | 2e. (2e) 6 0 | (55)(56)(76)(7^1e^) | 2e - - (05) |
Lc: 成长是快乐的旅途，勇敢迈开你的脚%步_{0} 宝
---
N: 1e (01e)(1e5)(31e) | 7 0 (XX)(03) | 6 (06)(65)(67) | 5 0 (XX) 0 |
Lc: 贝，妈妈怀里安睡。妈妈！宝贝，爸爸是你椅背。爸爸！
---
// preserve-start
N: 3 5 5 (1e1e) | (2e2e) 2e 6 0 | (55)(56)(71e)(1e2e) |
Lc: 你是我们的心肝宝贝，爸爸妈妈的爱永相
---
// highlight-next-line
J: 1.
N: 1e - - - | 
Lc: 随_{0}
---
// highlight-next-line
J:
N: &lpr; 3 - 5 1e | 2e. (2e) 6 - | 5 (56)(7)1e (2e) | 1e - - - &rpr; :||
---
// highlight-next-line
J: 2.
N: 1e - - (05) :||
Lc: 随_{0} 宝
---
// highlight-next-line
J: 3., "结束句", *
N: 1e - - - &int; | 3 5 5 (1e1e) | (2e2e)2e 6 - &int; | 5 6 7 1e | 1e - 2e^.(1e^) |
Lc: 随_{0} 你是我们的心肝宝贝，爸妈的爱永相
// preserve-end
---
J:
N: 1e~ - - - | 1e - - - | &lpr; 5 (56)(7)1e (2e) | 1e - - - | 1e 0 0 0 &rpr; |||
Lc: 随_{0}
`
} />

这里跳房子记号的含义是：第一次到达第 43 小节末尾时，进入标有 `1.` 的区间；第二次则进入 `2.` 区间，以此类推。

## 局部标号法的缺陷 {#local-problems}

结合上述例子，一个很自然的想法是，标号是为多行歌词、跳房子这样的记号服务的。没有它们，自然也不需要标号。因此，多行歌词的标号可以表示「经过这一段的次数」，而跳房子记号可以表示「经过跳房子区间开头的次数」。这样的标号思维，称为**局部标号法**。

局部标号法有着难以克服的缺陷，难以推广以应付复杂的曲式结构。至于为什么，不妨看一个例子。

我们现在要记录歌曲[《爱殇》](https://kuwo.cn/play_detail/183108704)的乐谱。我们希望尽可能充分利用反复记号，少写重复的部分。要做到这一点，第一步是将歌曲分段，并将段之间的相似、相同关系梳理出来。完成这一步后，可以画出段落结构的缩略图：

<C.RealtimeScore efRange={[1,7]} hide children={
`P: 1=? 4/4
Rp: n=6 sectionorder=none
====
A: "引子"
N: ____ |
---
A: "主歌A" | "主歌B"
N: ____ | ____ |
L:
A: "暮色起..." | "夜未央..." |
---
A: "主歌A" | "主歌B"
N: ____ | ____ |
L:
A: "我要将..." | "你曾经..." |
---
A: "副歌(I)"
N: ____ |
L:
A: "轻解霓裳..." |
---
A: "间奏"
N: ____ |
---
A: "主歌B"
N: ____ |
L:
A: "暮色起..." |
---
A: "副歌(II)" | "副歌(II')"
N: ____ | ____ |
L:
A: "船过空港..." | "扬帆远航..." |
---
A: "结束句" |
N: ____ |||
L:
A: "唯有你是我的天堂" |
`
} />

首先，我们发现第 2-5 段中，主歌 A 和主歌 B 均重复两遍，因此，可以利用反复记号反复它们。我们将它们的歌词合并，使用多行歌词来表示。

<C.RealtimeScore efRange={[1,7]} hide children={
`P: 1=? 4/4
Rp: n=6 sectionorder=none
====
A: "引子"
N: ____ |
---
A: "主歌A" | "主歌B"
N: ||: ____ | ____ :||
L:
A: "1.暮色起..." | "夜未央..." |
L:
A: "2.我要将..." | "你曾经..." |
---
A: "副歌(I)"
N: ____ |
L:
A: "轻解霓裳..." |
---
A: "间奏"
N: ____ |
---
A: "主歌B"
N: ____ |
L:
A: "暮色起..." |
---
A: "副歌(II)" | "副歌(II')"
N: ____ | ____ |
L:
A: "船过空港..." | "扬帆远航..." |
---
A: "结束句" |
N: ____ |||
L:
A: "唯有你是我的天堂" |
`
} />

这样就行了吗？并非如此！具体考察一下主歌 B 与之后段落的衔接方式，就会发现问题。第一遍主歌 B 接回主歌 A 时，是这样的：

<C.RealtimeScore efRange={1} hide children={
`P: 1=bB 4/4
Rp: font_lyrics=Roman,CommonSerif/600/0.95
N: 3. (5)(12)(1e7~) | (76~) 6~ - - | 6 - 0 0 |{"回到主歌A"} (06d)(6d5d)(6d6d)(6d5d) |
Lc: 留花瓣随风飘荡。我要将过往都储
`
} />

而第二遍主歌 B 接到副歌时，情况大致如此：

<C.RealtimeScore efRange={1} hide children={
`P: 1=bB 4/4
Rp: font_lyrics=Roman,CommonSerif/600/0.95
N: 3. (5)(12)(1e7~) | (76~) 6 0 (6^1e) | 2e 3e (6(1e2e~))(2e5e~) | (5e3e~) 3e^ 0 (6^1e) !|
Lc: 困在了眼泪中央。啊_{8} 啊_
`
} />

它们之间的差异靠插入一个反复记号并不能解决，必须使用跳房子记号才行。

<C.RealtimeScore efRange={1} hide children={
`P: 1=bB 4/4
Rp: font_lyrics=Roman,CommonSerif/600/0.95
N: 3. (5)(12)(1e7~) |
Lc[1.]: 留花瓣随风飘
Lc[2.]: 困在了眼泪中
---
J: 1.
N: (76~) 6~ - - | 6 - 0 0 :||
Lc: 荡。
---
J: 2.
N: ~ (76~) 6 0 (6^1e) !|
Lc: 央。啊_
`
} />

所以，我们的缩略图应该写成这样：

<C.RealtimeScore efRange={[1,7]} hide children={
`P: 1=? 4/4
Rp: n=6 sectionorder=none
====
A: "引子"
N: ____ |
---
A: "主歌A" | "主歌B"
N: ||: ____ | ____ |
L:
A: "1.暮色起..." | "夜未央...  飘" |
L:
A: "2.我要将..." | "你曾经...  中" |
---
J: 1.
A: "主歌B接主歌A"
N: ____ :||
L:
A: "荡。"
---
J: 2., *
A: "副歌(I)"
N: ____ |
L:
A: "央。轻解霓裳..." |
---
J: 2.
A: "间奏"
N: ____ |
---
J: 2.
A: "主歌B"
N: ____ |
L:
A: "暮色起..." |
---
J: 2.
A: "副歌(II)" | "副歌(II')"
N: ____ | ____ |
L:
A: "船过空港..." | "扬帆远航..." |
---
J: 2.
A: "结束句" |
N: ____ |||
L:
A: "唯有你是我的天堂" |
`
} />

注意到，第 7 段还出现了一个主歌 B，我们希望将这个主歌 B 也合并。非常简单，再反复一次即可...吗？

<C.RealtimeScore efRange={[1,7]} hide children={
`P: 1=? 4/4
Rp: n=6 sectionorder=none
====
A: "引子"
N: ____ |
---
A: "主歌A" | "主歌B"
N: ||: ____ ||: ____ |
L:
A: "1.暮色起..." | "  夜未央... 飘" |
L:
A: "2.我要将..." | "  你曾经... 中" |
L:
A: 0 | "3.暮色起... 怎"
---
J: 1.
A: "主歌B接主歌A"
N: ____ :||
L:
A: "荡。"
---
J: 2.
A: "副歌(I)"
N: ____ |
L:
A: "央。轻解霓裳..." |
---
J: 2.
A: "间奏"
N: ____ :||
---
J: 3.
A: "副歌(II)" | "副歌(II')"
N: ____ | ____ |
L:
A: "样。船过空港..." | "扬帆远航..." |
---
J: 3.
A: "结束句" |
N: ____ |||
L:
A: "唯有你是我的天堂" |
`
} />

似乎出现问题了——我们在主歌 B 前面添加了前反复记号，这会导致第一遍主歌 B 结束后无法接回主歌 A。在这里，我们只能使用另一种反复记号来暂且解决问题。

<C.RealtimeScore efRange={[1,7]} hide children={
`P: 1=? 4/4
Rp: n=6 sectionorder=none
====
A: "引子"
N: ____ |
---
A: "主歌A" | "主歌B"
N: ||: ____ |[$] ____ |
L:
A: "1.暮色起..." | "  夜未央... 飘" |
L:
A: "2.我要将..." | "  你曾经... 中" |
L:
A: 0 | "3.暮色起... 怎"
---
J: 1.
A: "主歌B接主歌A"
N: ____ :||
L:
A: "荡。"
---
J: 2.
A: "副歌(I)"
N: ____ |
L:
A: "央。轻解霓裳..." |
---
J: 2.
A: "间奏"
N: ____ {D.S., *}||
---
J: 3.
A: "副歌(II)" | "副歌(II')"
N: ____ | ____ |
L:
A: "样。船过空港..." | "扬帆远航..." |
---
J: 3.
A: "结束句" |
N: ____ |||
L:
A: "唯有你是我的天堂" |
`
} />

最后，副歌 (II) 和副歌 (II') 也是应该合并的，但是它们的尾部有一些不同，因此需要跳房子记号来区分。这里我们就要引入第二组跳房子记号。

<C.RealtimeScore efRange={[1,7]} hide children={
`P: 1=? 4/4
Rp: n=6 sectionorder=none
====
A: "引子"
N: ____ |
---
A: "主歌A" | "主歌B"
N: ||: ____ |[$] ____ |
L:
A: "1.暮色起..." | "  夜未央... 飘" |
L:
A: "2.我要将..." | "  你曾经... 中" |
L:
A: 0 | "3.暮色起... 怎"
---
J: 1.
A: "主歌B接主歌A"
N: ____ :||
L:
A: "荡。"
---
J: 2.
A: "副歌(I)"
N: ____ |
L:
A: "央。轻解霓裳..." |
---
J: 2.
A: "间奏"
N: ____ {D.S., *}||
---
A: "主歌B接副歌"
N: ____ |
L:
A: "样。"
---
A: "副歌(II).头" |
N: ||: ____ |
L:
A: "1.船过空港..." |
L:
A: "2.扬帆远航..." |
---
J: 1.
A: "副歌(II).尾"
N: ____ :||
L:
A: "是你的模样..."
---
J: 2.
A: "副歌(II').尾"
N: ____ |
L:
A: "寻你的模样..."
---
J: 2.
A: "结束句" |
N: ____ |||
L:
A: "唯有你是我的天堂" |
`
} />

这就是缩略图最后的样子。有了这个缩略图，我们就知道在记谱时如何谋篇布局了。

至此，这首歌的结构分析问题算是解决了。然而，显而易见，事情已经变得有一些混乱：编号 $1.$ 和 $2.$ 已经在多处被使用，表示的意义不尽相同；为了避免反复记号冲突，我们还混用了两种反复记号。我们不禁要问，

1. 如果曲式结构更加复杂，大量重复的编号是否容易导致可读性降低，甚至引起歧义？
2. 我们已经把仅有的两种反复记号都用掉了，如果结构更加复杂，需要更多组反复记号，该怎么办？

诚然，记号体系难以表达的复杂的曲式结构，可以通过补充一些文字说明来表达。但是，通过文字说明表达是低效且不严谨的，阅读并理解冗长的文字说明也会销蚀读者的注意力。如果能设计一套易于理解且能有效避免歧义的记号，当然是最理想的。

## 基于反复的标号 {#repeat-numbering}

考虑上述两个问题。第一个问题是说局部标号法会产生重复的编号，因此容易产生歧义，不够理想。

第二个问题是说，只有两种反复记号，可能不够用。然而，反复记号的种类非常有限是难以改变的事实。与其继续添加多种反复记号，不如采取其他措施进行区分，从而避免使用多种反复记号的需要。例如，上面的缩略图或许可以改成这样：

<C.RealtimeScore efRange={[1,7]} hide children={
`P: 1=? 4/4
Rp: n=6 sectionorder=none
====
A: "引子"
N: ____ |
---
A: "主歌A" | "主歌B"
N: ||: ____ ||:{"仅第三遍"} ____ |
L:
A: "1.暮色起..." | "  夜未央... 飘" |
L:
A: "2.我要将..." | "  你曾经... 中" |
L:
A: 0 | "3.暮色起... 怎"
---
J: 1.
A: "主歌B接主歌A"
N: ____ :||
L:
A: "荡。"
---
J: 2.
A: "副歌(I)"
N: ____ |
L:
A: "央。轻解霓裳..." |
---
J: 2.
A: "间奏"
N: ____ :||
---
A: "主歌B接副歌"
N: ____ |
L:
A: "样。"
---
A: "副歌(II).头" |
N: ||: ____ |
L:
A: "1.船过空港..." |
L:
A: "2.扬帆远航..." |
---
J: 1.
A: "副歌(II).尾"
N: ____ :||
L:
A: "是你的模样..."
---
J: 2.
A: "副歌(II').尾"
N: ____ |
L:
A: "寻你的模样..."
---
J: 2.
A: "结束句" |
N: ____ |||
L:
A: "唯有你是我的天堂" |
`
} />

甚至更加简洁一点，

<C.RealtimeScore efRange={[1,7]} hide children={
`P: 1=? 4/4
Rp: n=6 sectionorder=none
====
A: "引子"
N: ____ |
---
A: "主歌A" | ++"主歌B"
N: ||: ____ ||:{3., *} ____ |
L:
A: "1.暮色起..." | "  夜未央... 飘" |
L:
A: "2.我要将..." | "  你曾经... 中" |
L:
A: 0 | "3.暮色起... 怎"
---
J: 1.
A: "主歌B接主歌A"
N: ____ :||
L:
A: "荡。"
---
J: 2.
A: "副歌(I)"
N: ____ |
L:
A: "央。轻解霓裳..." |
---
J: 2.
A: "间奏"
N: ____ :||
---
A: "主歌B接副歌"
N: ____ |
L:
A: "样。"
---
A: "副歌(II).头" |
N: ||: ____ |
L:
A: "1.船过空港..." |
L:
A: "2.扬帆远航..." |
---
J: 1.
A: "副歌(II).尾"
N: ____ :||
L:
A: "是你的模样..."
---
J: 2.
A: "副歌(II').尾"
N: ____ |
L:
A: "寻你的模样..."
---
J: 2.
A: "结束句" |
N: ____ |||
L:
A: "唯有你是我的天堂" |
`
} />

但是，无论是「第三遍」还是「$3.$」，都依赖于标号。如果不解决标号重复的问题，当曲式结构变得复杂时，歧义在所难免。因此，所有的问题都可以归结为一点——标号是局部的，因而会出现重复标号，从而容易产生歧义。我们希望有一个更加**顾全大局**的标号方案。

原本我们认为标号是为多行歌词和跳房子记号服务的，因此产生了局部标号法。不妨换一个角度思考，标号是为了什么？为了区分。区分什么？区分不同的反复次数。而反复次数恰恰是反复导致的。根据这一点，我们就可以很自然地定义一种全局的标号：

- 歌曲开始时，标号为 $1$。
- 每次遇到反复记号需要跳转时，在**开始跳转之后，跳转到目标位置之前**的时候，将标号增加 $1$。

我们称这样的标号为**反复迭代数**。根据这一原则，我们的缩略图就可以改成这样：

<C.RealtimeScore efRange={[1,7]} hide children={
`P: 1=? 4/4
Rp: n=6 sectionorder=none
====
A: "引子"
N: ____ |
---
A: "主歌A" | ++"主歌B"
N: ||: ____ ||:{3., *} ____ |
L:
A: "1.暮色起..." | "  夜未央... 飘" |
L:
A: "2.我要将..." | "  你曾经... 中" |
L:
A: 0 | "3.暮色起... 怎"
---
J: 1.
A: "主歌B接主歌A"
N: ____ :||
L:
A: "荡。"
---
J: 2.
A: "副歌(I)"
N: ____ |
L:
A: "央。轻解霓裳..." |
---
J: 2.
A: "间奏"
N: ____ :||
---
A: "主歌B接副歌"
N: ____ |
L:
A: "样。"
---
A: "副歌(II).头" |
N: ||: ____ |
L:
A: "3.船过空港..." |
L:
A: "4.扬帆远航..." |
---
J: 3.
A: "副歌(II).尾"
N: ____ :||
L:
A: "是你的模样..."
---
J: 4.
A: "副歌(II').尾"
N: ____ |
L:
A: "寻你的模样..."
---
J: 4.
A: "结束句" |
N: ____ |||
L:
A: "唯有你是我的天堂" |
`
} />

这样，一切都变得清晰了。没有两种反复记号混用，也没有意义模棱两可的标号。并且，即便我们重新规定了标号的方法，初学音乐的读者仍然可以根据简单的推测就轻松明白我们的意思，这是最重要的一点。

### 重置迭代数 {#iter-reset}

拼接多个乐谱片段时，我们可能不希望反复修改乐谱中的标号。这时，可以在合适的位置添加 `reset` 记号使得迭代数被重置为 $1$。例如下面片段：

<C.RealtimeScore efRange={1} children={
`P: 1=C 4/4
---
N: 1 2 1 1 :|| 3 4 5 3 |
Lc[1.]: A...
Lc[2.]: B... %{3} C...
---
N: 4 3 2 2 ||: 1 2 1 1 :||
Lc[2.]: D... %{3} E...
Lc[3.]: %{4} F...
`
} />

在第三小节开头添加 `reset` 记号，即可变为，

<C.RealtimeScore efRange={1} children={
`P: 1=C 4/4
---
N: 1 2 1 1 :|| 3 4 5 3 |
Lc[1.]: A...
Lc[2.]: B... %{3} C...
---
// highlight-next-line
N: |{reset} 4 3 2 2 ||: 1 2 1 1 :||
Lc[1.]: D... %{3} E...
Lc[2.]: %{4} F...
`
} />

`reset` 可以作为小节线的后置或前置属性使用。<C.MinVersion min='1.15.7' inline>与转调/变速记号类似，`reset` 也可以用作小节线的**上方属性**，此时其作用与后置属性相同，但乐谱上方不会显示 $reset$。这时你可以自行添加文本来描述此处的变化。</C.MinVersion>

<C.RealtimeScore efRange={1} children={
`P: 1=C 4/4
---
N: 1 2 1 1 :|| 3 4 5 3 |
Lc[1.]: A...
Lc[2.]: B... %{3} C...
---
// highlight-next-line
N: |[reset]{"编号重置为1."} 4 3 2 2 ||: 1 2 1 1 :||
Lc[1.]: D... %{3} E...
Lc[2.]: %{4} F...
`
} />

## 编辑体验 - 曲式结构检查 {#experiences}

复杂的反复结构可能并不那么直观，因此，Sparks NMN 编辑器提供了一些用来检查曲式结构的工具。

### 利用音效试听窗口检查结构 {#test-play-check-structure}

音效试听窗口不仅仅可以用来试听，其进度条界面还可以用来检查乐谱的曲式结构是否正确。选择某个反复迭代数后，界面上将显示这一次反复包含哪些小节，利用这一点就可以直观地检查曲式结构。

<C.ImageBlock src={require('./assets/structure-check.png').default} />

如果你希望在音效试听过程中忽略一切反复记号以及跳房子等区分记号，在「反复次数」处选择 <Icons.VscCircleSlash style={{transform: 'translateY(0.13em)'}} /> 忽略反复与区分 即可。然而，这是不推荐的，因为这时解析器会直接从头到尾地读取变速与转调记号，而非按照反复记号以正常的顺序读取。

### 迭代数冲突校验 {#iter-conflict-check}

为了防止滥用 $reset$ 记号，Sparks NMN 禁止出现一个小节被经过两次，并且这两次对应的反复迭代数相同的情况。如果某小节处出现这种情况，这一小节右端会出现红色色块，并且编辑器会显示错误。

<C.RealtimeScore efRange={1} children={
`P: 1=C 0/4
Rp: time_lining=true
---
// highlight-next-line
N: 2 2 2 (3^5^) |{reset} 5 3 3 (2^1^) | 1 3 2 | 2 (1^6d^) 6d {}:||
// 花括号里加上一个 \`1.\` 就能死循环。
`
} />

此例子的反复结构：第一遍迭代数为 1，小节 1-4；第二遍迭代数为 2，小节 1；第三遍迭代数为 1，小节 2-4。因此小节 2-4 被认为出现了迭代数冲突。

## 接下来... {#next}

现在，我们有了一个明确、可推广的标号方式。接下来，我们将介绍跳房子、替代旋律、多行歌词、条件反复等记号以及它们的严谨含义。相比于局部标号法，它们在反复迭代数模型下有着更为简洁和明确的意义，同时将变得更加灵活，足以应对非常复杂的曲式结构。
