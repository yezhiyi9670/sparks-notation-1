---
sidebar_position: 4.1
description: 指定页面大小，使 Sparks NMN 自动优化排版，并添加页脚和页码。
---
import C from '@site/src/mdx'
import * as Cr from '@site/src/mdx/reference/renderprops'

# 自动分页、页脚、页面边距 {#pagination}

默认状态下，Sparks NMN 不会对乐谱进行分页，因此也不会标注页脚或页码。打印时，浏览器将负责对乐谱进行分页，而这种分页方法非常粗糙，可能对可读性产生不利影响（尤其是声部较多时）。

只须指定页面大小，Sparks NMN 就会对乐谱进行自动分页，并添加页码。页面底部的多余空间将均匀分配到乐谱行间距中（最后一页除外），使得乐谱匀称而美观。

本节中涉及这些渲染属性：

<Cr.RenderPropsReference filters={['family:page']} />

它们都只能在 `Rp:` 开头的全局渲染属性中使用。

## 定宽度显示机制 {#fixed-width}

此前，我们提到了 Sparks NMN 使用的布局单位 `em`，等于除去页面边距后的页面宽度的 $\frac{1}{100}$。事实上，Sparks NMN 的显示机制像图片一样，一切都以页面宽度为单位。

例如，音符高度始终约等于页面宽度的 $2.4\%$，那么在 A4 纸（宽度 $21.0\rm cm$）上，音符高度约为 $0.50\rm cm$；在 A5 纸（宽度 $10.5\rm cm$）上，音符高度会变成大约 $0.25\rm cm$。

要改变 `em` 相对于页面宽度的大小，应当修改控制文档缩放的渲染属性 `scale`。

## 指定页面大小 {#specify-page-size}

无论指定什么页面大小，只要不修改 `scale` 渲染属性，`em` 始终是除去页面边距后的页面宽度的 $\frac{1}{100}$。因此，指定页面大小，实际指定的是**页面高度与宽度的比值**，以告诉 Sparks NMN 应该在何处分页。

指定页面长宽比，可以通过 `page` 渲染属性：

<Cr.RenderPropsReference filters={['page']} />

有三种可能的指定方法：

- 使用预设的纸张 `A2`—`A6` 或者 `B3`—`B5`。A 系列的纸张长宽比为 1.4142，B 系列为 1.4157。
- 输入纸张的长度和宽度，例如 `27.9/21.0`。
- 直接给出纸张的长宽比，例如 `1.4142`。

例如《数鸭子》乐谱，

<C.RealtimeScore doPagination hide children={
`Dt: 数鸭子
Ds: 简单儿歌
Dv: Version 20230218
Da[作词]: 王嘉桢
Da[作曲]: 胡小环
P: 1=C 4/4
Rp: font_lyrics=Roman,CommonSerif/600/0.95
===
N: X X (XX) X | (XX) (XX) X 0 | (XX) (XX) (XX) X | (XX) (XX) X 0 |
Lc[1.]: 门前大桥下，游过一群鸭。快来快来数一数，二四六七八。
---
N: &lpr; (1e.(1e)) (55) (36) (53) | (21) (23) 1 - &rpr; |
---
N: ||: 3 1 (33) 1 | (33) (56) 5 - | (66) (65) (44) 4 | (23) (21) 2 - |
Lc[1.]: 门前大桥下，游过一群鸭。快来快来数一数，二四六七八。
Lc[2.]: 赶鸭老爷爷，胡子白花花。唱呀唱着家乡戏，还会说笑话。
---
N: 3 (10) 3 (10) | (33) (56) 6 - | 1e (55) 6 3 | (2^1^) (2^3^) 5 - | 1e (55) 6 3 | (2^1^) (2^3^) 1 - :||
Lc[1.]: 咕嘎咕嘎，真呀真多鸭，数不清到底多%少%鸭，数不清到底多%少%鸭。
Lc[2.]: 小孩小孩，快快上学校，别考个鸭蛋抱%回%家，别考个鸭蛋抱%回%家。
`
} />

在使用长宽比 0.707 的纸张分页后，预览将会显示为：

<C.RealtimeScore doPagination children={
`Dt: 数鸭子
Ds: 简单儿歌
Dv: Version 20230218
Da[作词]: 王嘉桢
Da[作曲]: 胡小环
// preserve-start
P: 1=C 4/4
// highlight-next-line
Rp: page=0.707 font_lyrics=Roman,CommonSerif/600/0.95
===
// preserve-end
N: X X (XX) X | (XX) (XX) X 0 | (XX) (XX) (XX) X | (XX) (XX) X 0 |
Lc[1.]: 门前大桥下，游过一群鸭。快来快来数一数，二四六七八。
---
N: &lpr; (1e.(1e)) (55) (36) (53) | (21) (23) 1 - &rpr; |
---
N: ||: 3 1 (33) 1 | (33) (56) 5 - | (66) (65) (44) 4 | (23) (21) 2 - |
Lc[1.]: 门前大桥下，游过一群鸭。快来快来数一数，二四六七八。
Lc[2.]: 赶鸭老爷爷，胡子白花花。唱呀唱着家乡戏，还会说笑话。
---
N: 3 (10) 3 (10) | (33) (56) 6 - | 1e (55) 6 3 | (2^1^) (2^3^) 5 - | 1e (55) 6 3 | (2^1^) (2^3^) 1 - :||
Lc[1.]: 咕嘎咕嘎，真呀真多鸭，数不清到底多%少%鸭，数不清到底多%少%鸭。
Lc[2.]: 小孩小孩，快快上学校，别考个鸭蛋抱%回%家，别考个鸭蛋抱%回%家。
`
} />

这时编辑器中的「粗排模式」字样会变成「共2页」，说明现在分页由 Sparks NMN 在预览时自动处理。

使用相匹配的纸张大小进行打印，即可得到经过布局调整且包含页码的纸质乐谱。

:::caution 注意

打印选择的纸张必须与渲染属性相匹配（相近，不需要严格相等）。如果纸张大小不匹配，可能导致页脚或乐谱错位。  
由于一些神奇且无法解释的问题，Firefox 浏览器无法自动设置正确的打印边距，需要手动调整。若使用基于 Chromium 的浏览器，只须在页面边距处选择「默认」即可正确排版。

:::

## 指定水平页面边距 {#custom-page-margin}

<C.MinVersion min='1.15.8' />

Sparks NMN 提供了一个渲染属性用来改变水平方向的页面边距，其单位也是 `em`。

<Cr.RenderPropsReference filters={['page_margin_x']} noMinVersion />

逗号隔开的两个数字用来分别指定左侧和右侧的边距，**注意逗号后不能有空格**。如果左右边距相等，可以只写一个数，例如 `11` 等价于 `11,11`。

默认的竖直方向的边距目前还不支持修改，如果有需要，可在打印时在浏览器中设定。

## 自定义页脚文本 {#custom-descender-text}

可以通过在文档开头添加信息行实现自定义页脚文本。

|头部信息|说明|全称|格式|
|-|-|-|-|
|页脚左侧文本| |`DocLeft`|`Dl: <文本>`|
|页面右侧文本| |`DocRight`|`Dr: <文本>`|

页脚文本中可以添加页码，`${0}` 表示当前页码，`${1}` 表示总页数。页脚右侧文本的默认值是 `Page ${0} / Total ${1}`。

## 双页对开 {#double-sided}

如果你的乐谱是在纸上双面打印，请开启下面的渲染属性。

<Cr.RenderPropsReference filters={['double_sided']} />

此时，偶数页面上的左右两侧边距和页脚文本都会对调。在这种情况下，让左侧页面边距大于右侧是很有意义的——可以在需要装订的一侧留出较大边距，防止装订后边缘上的音符难以阅读，但同时不会让另一侧有过大空白。

下面的例子中，两侧页面边距为 `14,10`。

<C.RealtimeScore doPagination children={
`Dt: 数鸭子
Ds: 简单儿歌
Dv: Version 20230218
Da[作词]: 王嘉桢
Da[作曲]: 胡小环
P: 1=C 4/4
// preserve-start
// highlight-next-line
Rp: page=0.707 page_margin_x=14,10 double_sided=true font_lyrics=Roman,CommonSerif/600/0.95
// preserve-end
===
N: X X (XX) X | (XX) (XX) X 0 | (XX) (XX) (XX) X | (XX) (XX) X 0 |
Lc[1.]: 门前大桥下，游过一群鸭。快来快来数一数，二四六七八。
---
N: &lpr; (1e.(1e)) (55) (36) (53) | (21) (23) 1 - &rpr; |
---
N: ||: 3 1 (33) 1 | (33) (56) 5 - | (66) (65) (44) 4 | (23) (21) 2 - |
Lc[1.]: 门前大桥下，游过一群鸭。快来快来数一数，二四六七八。
Lc[2.]: 赶鸭老爷爷，胡子白花花。唱呀唱着家乡戏，还会说笑话。
---
N: 3 (10) 3 (10) | (33) (56) 6 - | 1e (55) 6 3 | (2^1^) (2^3^) 5 - | 1e (55) 6 3 | (2^1^) (2^3^) 1 - :||
Lc[1.]: 咕嘎咕嘎，真呀真多鸭，数不清到底多%少%鸭，数不清到底多%少%鸭。
Lc[2.]: 小孩小孩，快快上学校，别考个鸭蛋抱%回%家，别考个鸭蛋抱%回%家。
`
} />



## 接下来... {#next}

你可能觉得 Sparks NMN 的默认排版有些「浪费纸」。一定程度上，这可以通过调节间距缓解。我们要介绍控制行距与段落间距的方式了。
