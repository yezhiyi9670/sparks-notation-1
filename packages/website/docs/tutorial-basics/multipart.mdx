---
sidebar_position: 7
description: 编写含多个声部的乐谱
---
import C from '@site/src/mdx'

# 多声部、紧凑声部、鼓点行 {#multipart}

多声部，即两个以上不同的简单旋律叠合在一起，彼此对齐，同时奏唱。合唱是多声部最典型的例子，不过除此之外，伴奏、和声、轮唱等形式也可以构成多声部。

本节介绍多声部的写法，常见应用场景以及注意事项。

## 多声部语法 {#multipart-syntax}

理论上我们一开始就介绍了多声部语法。还记得当时的事故现场吧？

<C.RealtimeScore  children={
`P: 1=C 4/4
N: 1 1 5 5 | 6 6 5 - | 4 4 3 3 | 2 2 1 - |
N: 5 5 4 4 | 3 3 2 - | 5 5 4 4 | 3 3 2 - |
N: 1 1 5 5 | 6 6 5 - | 4 4 3 3 | 2 2 1 - |
`
} />

没错，多个曲谱行在同一个碎片里，就是多声部。

多声部的每个声部下面都可以添加歌词。下面例子来自歌曲[《爱殇》](https://kuwo.cn/play_detail/183108704)。

<C.RealtimeScore efRange={[27,31]} children={
`Dp: 补全计划 - Netheric Playlist #0615
Dt: 爱殇
Da[作词]: MK
Da[作曲]: 小幻
Da[演唱]: 小时姑娘
P: 4/4 1=bB qpm=71
Rp: font_lyrics=Roman,CommonSerif/600/0.95 grayout=true margin_after_part=0 offset_lyrics_iter=0.8
====
Frp: n=5
N: - - - &lpr; (3e5e) | 2e (3e5e) 2e (3e5e) | (1e7)(65) 6 (65) | 6 (63e)(2e3e)(5e2e) | 3e - - (3e5e) |
---
Frp: n=5
N: 2e (3e5e) 2e (3e5e) | (1e7) (65) 6 (61e) | 3e (61e) 2e (3e5e) |
---
N: 6 - 7d 1 | 2 - 3 - &rpr; ||
---
N: ||: (06d)(6d5d)(6d6d)(6d5d) | 6d - 0 0 | (06d)(6d1)(21)7d | (3d5d~) 5d 0 (6d1) |
Lc[1.]: 暮色起看天边斜阳，恍惚想起你的脸庞。毕竟
Lc[2.]: 我要将过往都储藏，编一段美好的梦想。也许
---
N: 3^.(2^) 2. (1) | (35)(53) 6d (35) | 6d (35)(21)7d | (5d6d~) 6d 0 0 |
Lc[1.]: 回%想难免徒增感伤，轻叹息我们那些好时光。
Lc[2.]: 幻%想到最后会更伤，假欢畅又何妨无人共享。
---
N: ||:{3.} (05)(36d)(6d5)3 | (23~) 3 0 0 | (05)(36d)(6d5)6 | (5.(3~)) 3 0 (11) |
Lc[1.]: 夜未央繁星落眼眶，拾一段柔软的光芒。清风
Lc[2.]: 你曾经是我的边疆，抵挡我所有的悲伤。西风
Lc[3.]: 暮色起看天边斜阳，夜未央星河独流淌。天晴
Ns: 2: ((23~)3~) 3 0 0 |
---
N: 6 (35) 7 (67) | 1e (2e7) 1e - | 3. (5)(12)(1e7~) |
Lc[1.]: 过，曳烛光，独舞无人欣赏，留花瓣随风飘
Lc[2.]: 残，故人往，如今被爱流放，困在了眼泪中
Lc[3.]: 朗，好风光，若你不在身旁，能上苍穹又怎
---
J: 1.
N: (76~) 6~ - - | 6 - 0 0 :||
Lc[1.]: 荡。
// preserve-start
---
J: 2., *
N: ~ (76~) 6 0 (6^1e) | 2e 3e (6(1e2e~))(2e5e~) | (5e3e~) 3e^ 0 (6^1e) |
// highlight-next-line
Lc: 央。啊_{8} 啊_
N: 0 0 0 (6d1)  | 2 3 (6d(12~))(25~) | (53~) 3 0 (6d1) |
// highlight-next-line
Lc: 轻解霓裳，咽泪换笑妆。等你
---
B:
J:
N: 2e 3e (2e(1e2e~))(2e5e~) | (5e3e) 3e^ 0 ((5e^6e6e1ee)) | 6e. (3e) 2e^.(0) | (1ee^7e)(1ee2e) 1e^.(0) |
// highlight-next-line
Lc: _{8} 啊_{6} 啊_{4}
N: 2 3 (2(12~))(25~) | (53~) 3 0 ((6661e)) | (65)(63) 2.(0) | (1e7)(1e2) 1.(0) |
// highlight-next-line
Lc: 戎装，去呼啸沧桑。过往终究止不住流淌，去御剑飞翔，
// preserve-end
---
J:
N: (6^5e~) 5e~ -   (5e6)  | 1e^ - - &lpr;(61e) ||
Lc: 啊_{3}
N: (6d5)(56d)(6d)5 (6d) | 1 - - 0 ||
Lc: 也许会飞出这感伤。
---
J:
N: 2e 3e (6(1e2e~))(2e5e) | 3e - - (61e) | 2e 3e (2e3e)(5e6e) | 3e - - ((5e6e6e1ee)) |
---
J:
N: (6e5e)(6e3e) 2e -  | (1ee7e)(5e2e) 1e. (7) | (65e)(5e6)(65e)(5e6) | 1e - 2e 3e | #4e - #5e - &rpr; :||
---
N: ~ (76~) 6 0 (61e) ||: 2e 3e (6(1e2e~))(2e5e~) | (5e3e~) 3e 0 (61e) | 2e 3e (2e(1e2e~))(2e5e~) | (5e3e~) 3e - ((5e^6e6e1ee)) |
Lc[3.]: 样。船过空港，将寂寞豢养。旷野霜降，低垂了泪光。啊_{3}
Lc[4.]: %{3}    远航，敌不过彷徨。奈何流放，敌不过苍凉。啊_{3}
N: 0 0 0 (6d1) ||: 2 3 (6d(12~))(25~) | (53~) 3 0 (6d1) | 2 3 (2(12~))(25~) | (53~) 3 0 ((6661e)) |
Lc[3.]:     船过空港，将寂寞豢养。旷野霜降，低垂了泪光。是谁陨落
Lc[4.]: %{2}    远航，敌不过彷徨。奈何流放，敌不过苍凉。我要潜入
---
N: 6e.  (3e)2e^. (0)|
Lc: _{3}
N: (65)(63) 2. (0) |
Lc[3.]: 了我的太阳，
Lc[4.]: 回忆的汪洋，
---
J: 3.
N: (1ee^7e)(1ee2e) 1e^. (0) | (6^5e~) 5e - (5e6) | 1e^ - - (61e) :||
Lc: 啊_{4} 啊_{4} 扬帆
N: (1e7)(1e2) 1. (0) | (6d5)(56d)(6d)5 (6d) | 1 - - (6d1) :||
Lc[3.]: 是你的模样，带走我所有的光芒。扬帆
---
N: (1ee^7e)(1ee2ee) 1ee^. (0) | 5e~ - - (5e6) | 1e^ - - - ||
Lc: 啊_{4} 啊_{4}
N: (1e7)(1e2) 1. (0) | (6d5)(56d)(6d)5 (6d) | 1 - - - ||
Lc: 寻你的模样，唯有你是我的天堂。
---
N: /{"渐慢"} (65e)(5e6) (6)5e (6) |{qpm=58, "渐慢", 5/4} 1e - &lpr; (1e3e) 6e 7e |{4/4} 1ee[ext] - - - &rpr; |||
Lc: 唯有你是我的天堂。
`
} />

:::caution 常见错误

尽管并不强制，但是若两个声部均有歌词且是相同的，则应当在每个声部下面都写上歌词，而不是只写一遍。

:::

声部在碎片中出现的顺序是在不同碎片之间区分声部的依据，例如

<C.RealtimeScore efRange={1} children={
`P: 1=C 4/4
====
N: 1 1 1 1 |
---
N: 1 1 1 1 |
N: (1e1)(1e1)(1e1)(1e1) |
---
N: (5e(1e1))(5e(1e1))(5e(1e1))(5e(1e1)) |
N: 1 1 1 1 |
N: (1e1)(1e1)(1e1)(1e1) |
---
N: 1 1 1 1 |
N: (1e1)(1e1)(1e1)(1e1) |
N: (5e(1e1))(5e(1e1))(5e(1e1))(5e(1e1)) |
N: (3ee(5e1))(3ee(5e1))(3ee(5e1))(3ee(5e1)) |
`
} />

有时这并不是我们想要的效果。为了解决这个问题，也为了让读者更容易阅读，可以为声部添加名称。

## 添加声部名称 {#part-names}

在 `N:` 的 `N` 后面添加中括号，里面填入双引号引起的字符串，即可为声部添加名称。具体有这两种写法：

- `N["名称"]:`，表示一般的文本名称。
- `N["名称"_"下标"]`，表示带下标的文本名称。

举个例子，

<C.RealtimeScore efRange={1} children={
`P: 1=? 4/4
---
// highlight-next-line
N["M"]: (3e)3e (3e)(3e3e)(3e3e) | 3e (3e2e)(4e2e) 3e | 3e (4e2e) 3e 3e | 3e 4e 3e[brk] 0 |
// highlight-next-line
N["Ac"]: (6.6.6)(63) 6 | 4. (3) 2 3 | 6. (3) 4 6 | (6)6 (6)(22)(33) |
`
} />

添加了名称后，不同碎片下名称（包括下标）完全一致的声部会被认为是相同的声部。

<C.RealtimeScore efRange={1} children={
`P: 1=C 4/4
====
N["V"_"1"]: 1 1 1 1 |
---
N["V"_"1"]: 1 1 1 1 |
N["V"_"2"]: (1e1)(1e1)(1e1)(1e1) |
---
N["V"_"3"]: (5e(1e1))(5e(1e1))(5e(1e1))(5e(1e1)) |
N["V"_"1"]: 1 1 1 1 |
N["V"_"2"]: (1e1)(1e1)(1e1)(1e1) |
---
N["V"_"1"]: 1 1 1 1 |
N["V"_"2"]: (1e1)(1e1)(1e1)(1e1) |
N["V"_"3"]: (5e(1e1))(5e(1e1))(5e(1e1))(5e(1e1)) |
N["V"_"4"]: (3ee(5e1))(3ee(5e1))(3ee(5e1))(3ee(5e1)) |
`
} />

<C.SpoilerAlert variant='info' title='原理' desc={<>
	当一个曲谱行跨越了多个碎片时，有一个特殊的比较算法确保声部排序尽可能符合代码中的顺序。<br/>
	不过在实践中，仍然建议不同碎片之间声部的顺序保持一致，以保证代码的可读性。
</>}>

从曲谱行的第一个小节开始比较，先分别寻找两个声部在这一小节或之后第一次出现时（在碎片中）的序号（如果不存在记作 `-1`），然后进行比较。如果能够区分大小，那么序号小的排在前，如果不能，则继续比较下一个小节，直至分出先后为止。

以上面例子的 $\text{V}_1$ 和 $\text{V}_3$ 声部的比较为例。

首先在第一个小节比较：

- $\text{V}_1$ 在第 1 小节就有出现，碎片内序号为 1。
- $\text{V}_3$ 最早在第 3 小节出现，碎片内序号为 1。
- 无法比较，因此继续在第二小节比较。

第二个小节：

- $\text{V}_1$ 在第 2 小节出现，碎片内序号为 1。
- $\text{V}_3$ 最早在第 3 小节出现，碎片内序号为 1。
- 无法比较，因此继续在第三小节比较。

第三个小节：

- $\text{V}_1$ 在第 3 小节出现，碎片内序号为 2。
- $\text{V}_3$ 在第 3 小节出现，碎片内序号为 1。
- 因为 $2>1$，决定 $\text{V}_1$ 放在 $\text{V}_3$ 之后。

若调换第三小节中 $\text{V}_1$ 和 $\text{V}_3$ 的顺序，则 $\text{V}_1$ 最终将排在 $\text{V}_3$ 前面。

</C.SpoilerAlert>

## 空小节与隐藏小节线 {#empty-sections}

多声部乐谱中，有的声部可能在某些小节处是完全空的，可以选择将这些小节完全留空，而不是用休止符填充。只要在小节内容处写入 `empty`（<C.MinVersion min='1.15.4' inline>或者简写为 `e`</C.MinVersion>），就可以将小节留空。隐藏小节线 `/` 常常与空小节配合使用。

<C.RealtimeScore efRange={1} children={
`P: 1=C 4/4
====
N: 4 3 2 - | 5 4 3 - | 4 2 7d 2 | 1 - - - |||
// highlight-next-line
N: e / e / 6 4 2 4 | 3 - - - |||
`
} />

## 强制换行 {#force-break}

存在声部构成变化时，你可能希望在变化处进行换行。在碎片开头添加一行 `B:`（没有任何内容，但是冒号不能省略），即可实现在碎片前强制换行。

<C.RealtimeScore efRange={[1,4]} children={
`P: 1=C 4/4
====
N: 3 - (54)(34) | (4.(3~))(32) 6d - | 4 - (43)(24) |
---
// highlight-next-line
B:
N: 3 - - - | 3 - (43)(23) | 4. (4) 4 - | omit
N: 1 - - - | 1 - (21)(7d1) | 6d. (6d) 1 - | omit
`
} />

强制换行会导致上一行出现“不填满”的情况。这是有解决办法的。

<C.RealtimeScore efRange={[1,4]} children={
`P: 1=C 4/4
====
// highlight-next-line
Frp: n=3
N: 3 - (54)(34) | (4.(3~))(32) 6d - | 4 - (43)(24) |
---
B:
N: 3 - - - | 3 - (43)(23) | 4. (4) 4 - | omit
N: 1 - - - | 1 - (21)(7d1) | 6d. (6d) 1 - | omit
`
} />

这部分内容将在[布局与字体](/docs/tutorial-layout/section-lining#local-n)章节中具体介绍。

## 节省排版空间 {#saving-layout-space}

复杂的多声部乐曲可能会占据过多的排版空间。针对这个问题有两种解决方法。

### 鼓点行 {#drumline-parts}

有时我们希望将打击乐伴奏鼓点写出来。打击乐伴奏鼓点往往具有这样的特点：

- 音符的起始时刻重要，但是时值并不重要，因此一定不需要连音线。
- 没有或者几乎没有需要上下加点的音符。
- 减时线通常至多两条。

如此简单的声部，使用普通的多声部格式表达，未免有些浪费篇幅。Sparks NMN 提供了一种更加紧凑的记法——鼓点行。鼓点行开头的 `N` 改为 `Na`（或 `NotesAccompany`），其中的小节以格子的方式显示，占据的高度非常小，上下相邻的鼓点行中间没有行间距。像是这样：

<C.RealtimeScore efRange={[1,5]} children={
`P: 1=C 4/4
Rp: margin_between_parts=1.0
====
N["P1"]: ||:{3., [副歌]} 3e - (3e2e)(1e2e~) | (2e)7 (5~) 5 - | 0 7 (6)7 (1e~) | (1e6) 6 - - |
N["P3"]: ||: 0 0 0 0 | 0 0 0 0 | 0 0 0 0 | 0 1ee 7e 5e |
// highlight-next-line
Na["H"]: X Y (XY) (X0) | X Y (XY) (X0) | X Y (XY) (X0) | X Y (XY) (X0) |
// highlight-next-line
Na["B"]: (XY)(XY)(XY)(XY) | (XY)(XY)(XY)(XY) | (XY)(XY)(XY)(XY) | (XY)(XY)(XY)(XY) |
---
N["P1"]: 0 (3e3e)(3e2e)(1e2e~) | (2e)5e (7~) 7 - | (07)(77)(76)(71e~) | (1e6~) 6 - - ||
N["P3"]: 6e 0 0 0 | 0 0 0 0 | 3 0 0 0 | 0 0 0 0 ||
// highlight-next-line
Na["H"]: X Y (XY) (X0) | X Y (XY) (X0) | X Y (XY) (X0) | X Y (XY) (X0) |
// highlight-next-line
Na["B"]: (XY)(XY)(XY)(XY) | (XY)(XY)(XY)(XY) | (XY)(XY)(XY)(XY) | (XY)(XY)(XY)(XY) |
`
} />

即使名称相同，鼓点行和普通声部也不会被视为同一个声部。尽管不显示小节线及小节线属性，鼓点行的代码中仍然需要描述变拍和变速。

鼓点行不会框进连谱号中。

### 紧凑声部 {#compact-parts}

<C.MinVersion min='1.14.22' />

有的乐曲中，几个低音声部可能会被用来充当鼓点，它们的排版空间也可以压缩，但是不适合使用鼓点行。这时，可以将音符行开头改为 `Nc`（或 `NotesAccompany`），使其成为紧凑声部。紧凑声部占据的高度会略小于普通声部，并且相邻的紧凑声部之间没有间距。

<C.RealtimeScore efRange={1} children={
`P: 1=C 6/8 spm=210
Rp: margin_between_parts=1.0
====
N["1"]: 1e (1e)(1e2e3e) | 2e (7) 5. | 6. (456) | 5~. 5. |
A: c"1" | c"5". c"5d7" | c"4" | c"1" |
N["2"]: (353)(351e) | (525)(247d) | (141)(134) | (315d)(5d13) |
// highlight-next-line
Nc["I"]: 1d.        1d  (3d)  | 7dd.       2d  (7dd) | 1d.        6dd (1d)  | 1d.        3d  (1d)  |
// highlight-next-line
Nc["R"]: 5dd (5dd~) 5dd (5dd) | 5dd (5dd~) 5dd (5dd) | 4dd (4dd~) 4dd (4dd) | 5dd (5dd~) 5dd (5dd) |
`
} />

与鼓点行不同，紧凑声部与同名的普通声部会被认为是相同的声部。显示时，某一行是否为紧凑声部取决于其第一小节是否为紧凑声部。

## 编辑体验 - 多声部 {#multipart}

### 在音效试听中控制声部 {#test-play-control-parts}

<C.MinVersion min='1.14.1' />

使用多声部时，音效试听的混音控制区将列出所有声部。这允许用户进行更加精细的控制，也方便用户在检查时便捷地静音某些声部。

<C.ImageBlock src={require('./assets/part-controls.png').default} />

目前此功能按照序号和声部名称来区分声部，并且每个声部都有一个控件，因此复杂的乐谱将会有非常多的混音控件。这一点有待改进。

## 接下来... {#next}

接下来，我们要了解一下如何表示转调、变拍与变速。不说人话，就是在旋律的中间改变乐理属性。不过，此前，还需要快速了解一下关于小节线属性的概念，以保证你能弄懂改变乐理属性的原理。
